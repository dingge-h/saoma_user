{"version":3,"sources":["uni-app:///main.js","webpack:///D:/点餐小程序/点餐小程序/pages/home-page/page.vue?abdc","webpack:///D:/点餐小程序/点餐小程序/pages/home-page/page.vue?9a1a","webpack:///D:/点餐小程序/点餐小程序/pages/home-page/page.vue?d22c","webpack:///D:/点餐小程序/点餐小程序/pages/home-page/page.vue?d164","uni-app:///pages/home-page/page.vue","webpack:///D:/点餐小程序/点餐小程序/pages/home-page/page.vue?e087","webpack:///D:/点餐小程序/点餐小程序/pages/home-page/page.vue?7eb7"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page"],"mappings":";;;;;;;;;;kDAAA;AACA;AACA,+F,6FAFmBA,EAAE,CAACC,iCAAH,GAAuCC,mBAAvC;AAGnBC,UAAU,CAACC,aAAD,CAAV,C;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA6H;AAC7H;AACwD;AACL;AACqC;;;AAGxF;AACmK;AACnK,gBAAgB,6KAAU;AAC1B,EAAE,0EAAM;AACR,EAAE,2FAAM;AACR,EAAE,oGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,+FAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC,KAAI;AAC5C;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACdA;AAAA;AAAA;AAAA;AAAimB,CAAgB,8mBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACsGrnB;;AAEA;;;;;;AAMA,uE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;eAdA,O,CAAA,G,YAAA,G,EACA;gpBAQA,6BACA,mBACA,+CACA,+C,CACA;eAEA,EACA,cACA,gBADA,EAEA,UAFA,EADA,EAKA,IALA,kBAKA,CACA,SACA,WADA,EACA;AACA,gBAFA,EAEA;AACA,eAHA,EAGA;AACA,mBAJA,EAIA;AACA,eALA,EAKA;AACA,qBANA,EAOA,WAPA,EAOA;AACA,uBARA,EAQA;AACA,sBATA,EASA;AACA,qBAVA,EAUA;AACA,4DAXA,EAWA;AACA,sBAZA,CAYA;AAZA,MAcA,CApBA,EAqBA,WACA;AACA,WAFA,mBAEA,KAFA,EAEA,GAFA,EAEA,kBACA,qBACA,uBACA,wBACA,uBACA,CAFA,EAEA,GAFA,EAGA,CARA,EAUA;AACA,UAXA,kBAWA,KAXA,EAWA,CACA,uCACA;AACA,wDACA,kBACA,CACA,CAJA,MAIA;AACA,2DACA,kBACA,CACA,CACA,wBACA,CAvBA,EAyBA;AACA,QA1BA,gBA0BA,KA1BA,EA0BA,UA1BA,EA0BA,GA1BA,EA0BA,QA1BA,EA0BA,yFACA,QADA,GACA,QADA,CACA,QADA,CACA,KADA,GACA,QADA,CACA,KADA,CACA,IADA,GACA,QADA,CACA,IADA,CACA,SADA,GACA,QADA,CACA,SADA,CACA,IADA,GACA,QADA,CACA,IADA,CACA,GADA,GACA,QADA,CACA,GADA,CACA,UADA,GACA,QADA,CACA,UADA,CAEA,gDACA,oEACA,8EACA,4EALA,CAMA;AACA,uCACA,uDACA,sLACA,wBACA,CArCA,EAuCA;AACA,UAxCA,kBAwCA,KAxCA,EAwCA,UAxCA,EAwCA,GAxCA,EAwCA,QAxCA,EAwCA,KACA,QADA,GACA,QADA,CACA,QADA,CACA,KADA,GACA,QADA,CACA,KADA,CACA,IADA,GACA,QADA,CACA,IADA,CACA,SADA,GACA,QADA,CACA,SADA,CACA,IADA,GACA,QADA,CACA,IADA,CACA,GADA,GACA,QADA,CACA,GADA,CACA,UADA,GACA,QADA,CACA,UADA,CAEA,sBACA,oEAHA,CAIA;AACA,uCACA,uDACA,sLACA,wBACA,CAjDA,EAmDA;AACA,iBApDA,yBAoDA,GApDA,EAoDA,CACA,qCACA,6BACA,CAFA,MAEA,CACA,4FACA,sBACA;AACA,0CACA,CAHA,MAGA,CACA,mEACA,yEACA,uEACA,qEACA,CACA,CACA,uBACA,CApEA,EAsEA;AACA,mBAvEA,6BAuEA,mBACA,+BACA,aACA,+BACA,oBACA,+BACA,CAFA,MAEA,CACA,8BACA,CACA,CANA,EAOA,WACA,oBACA,kCACA,CACA,2BACA,+FACA,oEACA,CAHA,EAIA,CAzFA,EA4FA;AACA,yBA7FA,iCA6FA,KA7FA,EA6FA,EA7FA,EA6FA,GA7FA,EA6FA,GA7FA,EA6FA,UA7FA,EA6FA,SA7FA,EA6FA,CACA,qDADA,CAEA;AACA,uCACA,uDACA,kEALA,CAMA;AACA;AACA;AACA;AACA,KAvGA;;AAyGA;AACA,cA1GA,wBA0GA;AACA;AACA;AACA;AACA;AACA;AACA,SAFA;AAGA,OAJA;AAKA;AACA,KAnHA;;AAqHA;AACA,cAtHA,wBAsHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KA7HA;;AA+HA;AACA,gBAhIA,0BAgIA;AACA;AACA,KAlIA;;AAoIA;AACA,UArIA,oBAqIA;;AAEA,mEAFA,SAEA,GAFA;AAGA,qDAHA,CAGA;AACA,kDAJA,CAIA;AACA;AACA;AACA,iBAFA,EALA;AAQA,KA7IA;;AA+IA;AACA,gBAhJA,0BAgJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAHA;AAIA,OALA;AAMA,KA3JA;;AA6JA;AACA,iBA9JA,2BA8JA;AACA;AACA;AACA,+BADA;AAEA;AACA;AACA,SAJA;AAKA;AACA;AACA,SAPA;;AASA,KAzKA;;AA2KA;AACA,gBA5KA,0BA4KA;AACA;AACA,mBAFA,GAEA,4EAFA;AAGA;AACA,2BAJA,GAIA,CAJA;AAKA;;AAEA;AACA,4BARA,GAQA,8BARA;AASA,gCATA,GASA,qCATA;AAUA,qBAVA,GAUA;AACA,4CADA,EACA;AACA,oDAFA,EAEA;AACA,uFAHA;AAIA,0CAJA;AAKA,8CALA;AAMA,6CANA,EAMA;AACA,+CAPA,EAOA;AACA,6CARA,EAVA;;AAoBA;AACA,yBArBA,GAqBA,mBArBA;;AAuBA,+IAvBA,UAuBA,KAvBA;AAwBA,sCAxBA;;AA0BA,mDA1BA;;AA4BA;AACA,4BA7BA,GA6BA,+CA7BA;AA8BA;AACA;AACA,+CADA;AAEA,mDAFA;AAGA,gDAHA,EADA,GA9BA;;;;AAsCA;AACA;AACA,+GADA;;AAGA;AACA,yBA3CA,GA2CA,gDA3CA;AA4CA,+EA5CA;AA6CA,sCA7CA,CA6CA;AACA;AACA;AACA,qDADA;;AAGA;AAlDA,2CAmDA,0FAnDA;;AAqDA,+DArDA;;AAuDA,KAnOA;;AAqOA;AACA,gBAtOA,0BAsOA;AACA;AACA;AACA,6BADA,EACA;AACA,yBAFA,EAEA;AACA;AACA;AACA,SALA;AAMA;AACA;AACA,SARA;;AAUA,KAlPA;;AAoPA;AACA,YArPA,sBAqPA;AACA;AACA,uCADA;;AAGA,KAzPA,EArBA;;AAgRA,QAhRA,oBAgRA;AACA;AACA;AACA;AACA,GApRA;;AAsRA,QAtRA,oBAsRA;AACA;AACA,GAxRA;;AA0RA;AACA;AACA,kBAFA,4BAEA;AACA;AACA;AACA;AACA,OAFA;AAGA;AACA,KARA,EA1RA,E;;;;;;;;;;;;AC/GA;AAAA;AAAA;AAAA;AAA44B,CAAgB,23BAAG,EAAC,C;;;;;;;;;;;ACAh6B;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/home-page/page.js","sourcesContent":["import 'uni-pages';wx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/home-page/page.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./page.vue?vue&type=template&id=2f68e6da&scoped=true&\"\nvar renderjs\nimport script from \"./page.vue?vue&type=script&lang=js&\"\nexport * from \"./page.vue?vue&type=script&lang=js&\"\nimport style0 from \"./page.vue?vue&type=style&index=0&id=2f68e6da&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"2f68e6da\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/home-page/page.vue\"\nexport default component.exports","export * from \"-!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./page.vue?vue&type=template&id=2f68e6da&scoped=true&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  if (!_vm._isMounted) {\n    _vm.e0 = function($event) {\n      $event.stopPropagation()\n      _vm.total_quantity == 0 ? false : true && _vm.placean_order()\n    }\n  }\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./page.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./page.vue?vue&type=script&lang=js&\"","<template>\r\n    <view>\r\n        <!-- 顶部 -->\r\n        <view class=\"top-view\">\r\n            <view>{{number_people}}人就餐</view>\r\n            <view class=\"top-view-flex\">\r\n                <image src=\"/static/tab/fenxiang.svg\" mode=\"widthFix\" class=\"top-search\"></image>\r\n                <image src=\"/static/tab/dingdan.svg\" mode=\"widthFix\" @click=\"my_order()\"></image>\r\n            </view>\r\n        </view>\r\n        <!-- 点餐界面 -->\r\n        <view class=\"order-view\">\r\n            <view class=\"commodity\">\r\n                <!-- 左 -->\r\n                <view class=\"order-left\">\r\n                    <scroll-view scroll-y=\"true\" class=\"scroll-Hei\" :scroll-with-animation=\"true\" :enhanced=\"true\"\r\n                        :show-scrollbar=\"false\">\r\n                        <block v-for=\"(item,index) in itemize\" :key=\"index\">\r\n                            <view class=\"itemize-text\" :class=\"{active: index == trigger}\"\r\n                                @click=\"itemIze(index,item.cid)\">\r\n                                <text>{{item.value}}</text>\r\n                                <text v-if=\"item.sele_quantity > 0\">{{item.sele_quantity}}</text>\r\n                 \t\t\t</view>\r\n                        </block>\r\n                \t   </scroll-view>\r\n                </view>\r\n                <!-- 右 -->\r\n                <view class=\"order-right\">\r\n                    <scroll-view scroll-y=\"true\" class=\"scroll-Hei\" :scroll-with-animation=\"true\" :enhanced=\"true\"\r\n                        :show-scrollbar=\"false\" :scroll-into-view=\"scroll_into\" @scroll=\"scroLl\">\r\n                        <block v-for=\"(item,index) in goods\" :key=\"index\">\r\n                            <view :id=\"item.cid\" class=\"rig-height\">\r\n                   \t\t\t          <view class=\"classif\">{{item.category}}</view>\r\n                      \t\t\t       <view class=\"classif-goods\" v-for=\"(itemgood,good_index) in item.good_query\"\r\n                                    :key=\"good_index\" @click=\"popup_item(true,index,good_index,item.cid,itemgood)\">\r\n                                    <view class=\"goods-image\">\r\n                                        <image :src=\"itemgood.image[0].url\" mode=\"aspectFill\"></image>\r\n                                    </view>\r\n                                    <view class=\"goods-Price\">\r\n                                        <view class=\"goods-name\">\r\n                                            <text class=\"Bold\">{{itemgood.name}}</text>\r\n                                            <text class=\"Thinning\">已售 {{itemgood.monthlysale}}</text>\r\n                      \t\t\t\t\t             </view>\r\n                                        <view class=\"unit-price\">\r\n                                            <text class=\"Symbol\">¥</text>\r\n                                            <text class=\"Bold\">{{itemgood.unitprice}}</text>\r\n                                            <text class=\"Thinning\">/{{itemgood.unit}}</text>\r\n                                        </view>\r\n                                    </view>\r\n                                    <!-- 无规格 -->\r\n                                    <view class=\"quantity\" v-if=\"!itemgood.att_hide\">\r\n                                        <view>\r\n                                            <image v-if=\"itemgood.quantity > 0\" src=\"/static/tab/jianhao.png\"\r\n                                                mode=\"widthFix\"\r\n                                                @click.stop=\"reduce(index,good_index,item.cid,itemgood)\"></image>\r\n                                        </view>\r\n                                        <view><text v-if=\"itemgood.quantity > 0\">{{itemgood.quantity}}</text></view>\r\n                                        <view>\r\n                                            <image src=\"/static/tab/jia.png\" mode=\"widthFix\"\r\n                                                @click.stop=\"plus(index,good_index,item.cid,itemgood)\"></image>\r\n                                        </view>\r\n                                    </view>\r\n                                    <!-- 有规格 -->\r\n                                    <view class=\"quantity specs-view\" v-if=\"itemgood.att_hide\">\r\n                     \t\t\t\t\t              <text>选规格</text>\r\n                                        <text v-if=\"itemgood.quantity > 0\">{{itemgood.quantity}}</text>\r\n                                    </view>\r\n                                </view>\r\n                            </view>\r\n                  \t\t</block>\r\n                        <view style=\"height: 250rpx;\"></view>\r\n                    </scroll-view>\r\n                </view>\r\n            </view>\r\n            <!-- 底部 -->\r\n            <view class=\"order-bottom\" @click=\"pop_Shopping()\" :style=\"{'padding-bottom': Modelmes ? '68rpx' : ''}\">\r\n            \t<view class=\"Shopping\" style=\"width: 115rpx;\">\r\n            \t\t<view class=\"Shopping-left\">\r\n            \t\t\t<image src=\"/static/tab/gouwuche.png\" mode=\"widthFix\"></image>\r\n            \t\t</view>\r\n            \t\t<view class=\"Shopping-number\" v-if=\"total_quantity > 0\">{{total_quantity}}</view>\r\n            \t</view>\r\n            \t<view class=\"Shopping-title\" v-if=\"total_quantity > 0\">已点{{total_quantity}}份菜品</view>\r\n            \t<view class=\"place-order\" @click.stop=\"total_quantity == 0 ? false : true && placean_order()\">\r\n            \t\t<button plain=\"true\" open-type=\"getUserInfo\">选好了</button>\r\n            \t</view>\r\n            </view>\r\n        </view>\r\n        <!-- 购物车 -->\r\n        <Cart v-if=\"card\" :shopping_card=\"shopping_card\"></Cart>\r\n        <!-- 引入单个商品弹出 -->\r\n        <Details v-if=\"popupitem\" :pro_details=\"pro_details\"></Details>\r\n    </view>\r\n</template>\r\n\r\n<script>\r\n    const {log} = console\r\n    // 购物车\r\n    import Cart from './components/shopping-cart.vue'\r\n    // 引入单个商品弹出\r\n    import Details from './components/goods-details.vue'\r\n    // 订单编号\r\n    import {Code} from '../../config/order.js'\r\n    // 计算当天的销售额\r\n    import {analysis} from '../../config/Date_analysis.js'\r\n    const db = wx.cloud.database()\r\n    const _ = db.command\r\n    const good_collect= db.collection('order-data')\r\n    const dishes_data = db.collection('dishes-data')\r\n    // 打印小票\r\n    import {yunPrint} from '../../printer/request.js'\r\n    export default {\r\n        components: {\r\n            Details,\r\n            Cart\r\n        },\r\n        data() {\r\n            return {\r\n                itemize: [], //类目\r\n                trigger: 0, //类目选中的值\r\n                goods: [], //所有菜品\r\n                heightset: [], //存储右边每一个分类菜品的高度\r\n                tophei: 0, //滚动时距离顶部的高度\r\n                scroll_into: '',\r\n                card: false, //购物车隐藏\r\n                shopping_card: [], //购物车里的数据\r\n                popupitem: false, //单个商品弹出框隐藏\r\n                pro_details: {}, //单个商品弹出框里的数据\r\n                tmplIds: 'a3K7cJTKlm3x3X26mjEe1sW5dIY-OcPLJCvJa33ZGzs', //模板id\r\n                number_people: 0, //用餐人数\r\n            }\r\n        },\r\n        methods: {\r\n            // 点击类目加上背景色\r\n            itemIze(index,cid){\r\n            \tthis.trigger = index\r\n            \tthis.scroll_into = cid\r\n            \tsetTimeout(()=>{\r\n            \t\tthis.scroll_into = ''\r\n            \t},200)\r\n            },\r\n            \r\n            // 右边菜品滚动时触发\r\n            scroLl(event){\r\n            \tlet scrollTop = event.detail.scrollTop\r\n            \tif(scrollTop >= this.tophei){//上拉\r\n            \t\tif(scrollTop >= this.heightset[this.trigger]){\r\n            \t\t\tthis.trigger += 1\r\n            \t\t}\r\n            \t}else{//下拉\r\n            \t\tif(scrollTop < this.heightset[this.trigger - 1]){\r\n            \t\t\tthis.trigger -= 1\r\n            \t\t}\r\n            \t}\r\n            \tthis.tophei = scrollTop\r\n            },\r\n            \r\n            // 单个商品+\r\n            plus(index,good_index,cid,itemgood,Men='001'){\r\n            \tconst {quantity,image,name,unitprice,unit,_id,good_specs} = itemgood\r\n            \tconst QU =  Men == '001' ? quantity + 1 : quantity\r\n            \tthis.$set(this.goods[index].good_query[good_index],'quantity',QU)\r\n            \tthis.$set(this.goods[index].good_query[good_index],'good_specs',good_specs)\r\n            \tthis.$set(this.goods[index].good_query[good_index],'unitprice',unitprice)\r\n                // 解决总价出现浮点数的问题\r\n                let total_price = unitprice * QU\r\n                let total_prices = parseFloat((total_price).toFixed(10))\r\n            \tconst arr = {image,name,good_specs,unitprice,quantity:QU,unit,total_price:total_prices,_id,cid,good_index}\r\n            \tthis.shopping_Cart(arr)\r\n            },\r\n            \r\n            // 单个商品-\r\n            reduce(index,good_index,cid,itemgood){\r\n            \tconst {quantity,image,name,unitprice,unit,_id,good_specs} = itemgood\r\n            \tconst QU = quantity - 1\r\n            \tthis.$set(this.goods[index].good_query[good_index],'quantity',QU)\r\n                // 解决总价出现浮点数的问题\r\n                let total_price = unitprice * QU\r\n                let total_prices = parseFloat((total_price).toFixed(10))\r\n            \tconst arr = {image,name,good_specs,unitprice,quantity:QU,unit,total_price:total_prices,_id,cid,good_index}\r\n            \tthis.shopping_Cart(arr)\r\n            },\r\n            \r\n            // 添加进购物车的商品\r\n            shopping_Cart(arr){\r\n            \tif(this.shopping_card.length == 0){\r\n            \t\tthis.shopping_card.push(arr)\r\n            \t}else{\r\n            \t\tlet itemindex = this.shopping_card.findIndex(item => item._id == arr._id)\r\n            \t\tif(itemindex == -1){\r\n            \t\t\t// 没有相同的菜品存在\r\n            \t\t\tthis.shopping_card.unshift(arr)\r\n            \t\t}else{\r\n            \t\t\tthis.$set(this.shopping_card[itemindex],'quantity',arr.quantity)\r\n            \t\t\tthis.$set(this.shopping_card[itemindex],'total_price',arr.total_price)\r\n            \t\t\tthis.$set(this.shopping_card[itemindex],'good_specs',arr.good_specs)\r\n            \t\t\tthis.$set(this.shopping_card[itemindex],'unitprice',arr.unitprice)\r\n            \t\t}\r\n            \t}\r\n            \tthis.qunint_of_goods()\r\n            },\r\n            \r\n            // 计算左边各分类下添加了多少菜品\r\n            qunint_of_goods(){\r\n            \tlet array = this.shopping_card\r\n            \tlet res = {}\r\n            \tarray.forEach(item=>{\r\n            \t\tif(res[item.cid]){\r\n            \t\t\tres[item.cid] += item.quantity\r\n            \t\t}else{\r\n            \t\t\tres[item.cid] = item.quantity\r\n            \t\t}\r\n            \t})\r\n            \tlet M = []\r\n            \tfor(let k in res){\r\n            \t\tM.push({cid:k,value:res[k]})\r\n            \t}\r\n            \tM.forEach(item=>{\r\n            \t\tlet res_index = this.itemize.findIndex(iteming => iteming.cid == item.cid)\r\n            \t\tthis.$set(this.itemize[res_index],'sele_quantity', item.value)\r\n            \t})\r\n            },\r\n            \r\n            \r\n            //购物车商品加减数量\r\n            shopping_Cart_add_sub(index,QU,_id,cid,good_index,unitprice){\r\n            \tthis.$set(this.shopping_card[index],'quantity',QU)\r\n                // 解决总价出现浮点数的问题\r\n                let total_price = unitprice * QU\r\n                let total_prices = parseFloat((total_price).toFixed(10))\r\n            \tthis.$set(this.shopping_card[index],'total_price',total_prices)\r\n            \t// 根据_id唯一标识查询商品的数量做到商品加减同步\r\n            \tconst itemcid = this.goods.findIndex(item=> item.cid == cid)\r\n            \tthis.$set(this.goods[itemcid].good_query[good_index],'quantity',QU)\r\n            \tthis.qunint_of_goods()\r\n            },\r\n            \r\n            // 清空购物车\r\n            empty_data(){\r\n            \tthis.shopping_card = []\r\n            \tthis.itemize.forEach(item=>{item.sele_quantity = 0})\r\n            \tthis.goods.forEach(item=>{\r\n            \t\titem.good_query.forEach(T=>{\r\n            \t\t\tT.quantity = 0\r\n            \t\t})\r\n            \t})\r\n            \tthis.pop_Shopping(false)\r\n            },\r\n            \r\n            // 弹出或隐藏单个商品弹出框\r\n            popup_item(value = true,index,good_index,cid,itemgood){\r\n            \tthis.popupitem = value\r\n            \t// 选取最小的值排在第一\r\n            \tif(value){\r\n            \t\titemgood.specs.sort((A,B)=>{return (A.unitprice - B.unitprice)})\r\n            \t\tthis.pro_details = {index,good_index,cid,itemgood}\r\n            \t}\r\n            },\r\n            \r\n            // 显示购物车组件\r\n            pop_Shopping(value = true){\r\n            \tthis.card = value\r\n            },\r\n            \r\n            // 请求数据\r\n            async dishEs() {\r\n                // 请求云函数获取分类和菜品数据\r\n                const res = await wx.cloud.callFunction({name: 'dish',data: {}})\r\n                this.itemize = res.result.res_cate //类目\r\n                this.goods = res.result.res_dis //所有菜品\r\n                this.$nextTick(()=>{\r\n                \tthis.goods_height()\r\n                })\r\n            },\r\n            \r\n            // 计算右边每个分类菜品的高度\r\n            goods_height(){\r\n            \tthis.heightset = []\r\n            \tlet cate_height = 0\r\n            \tconst query = wx.createSelectorQuery()\r\n            \tquery.selectAll('.rig-height').boundingClientRect()\r\n            \tquery.exec((res)=>{\r\n            \t\tres[0].forEach((item)=>{\r\n            \t\t\tcate_height += item.height\r\n            \t\t\tthis.heightset.push(cate_height)\r\n            \t\t})\r\n            \t})\r\n            },\r\n            \r\n            // 弹出订阅消息弹窗\r\n            placean_order(){\r\n                // 消息弹窗\r\n                wx.requestSubscribeMessage({\r\n                    tmplIds: [this.tmplIds],\r\n                    success:(res)=>{\r\n                        this.sub_database()\r\n                    },\r\n                    fail:(err)=>{\r\n                        this.sub_database()\r\n                    }\r\n                })\r\n            },\r\n            \r\n            // 提交订单\r\n            async sub_database(){\r\n                // 1.过滤掉总价为0的购物车里的菜品;filter:过滤\r\n                let res = this.shopping_card.filter(item => item.total_price != 0)\r\n                // 2.计算总价\r\n                let sett_amount = 0\r\n                res.forEach(item => {sett_amount += item.total_price})\r\n                \r\n                // 取出本地缓存的桌号和用餐人数\r\n                let table_number = wx.getStorageSync('table_num')\r\n                let number_of_diners = wx.getStorageSync('number_of_diners')\r\n                let order = {\r\n                \ttable_number,//桌号\r\n                \tnumber_of_diners,//用餐人数\r\n                \torder_time:this.$Time().utcOffset(8).format('YYYY-MM-DD HH:mm:ss'),\r\n                \tsett_amount,\r\n                \torder_no:Code(),\r\n                \ttransac_status:'unsettled',//结账状态\r\n                \torder_receiving:'mis_orders',//接单状态\r\n                \tmenu:[{goods_list:res}]\r\n                }\r\n                // 加菜\r\n                let add_goods = {goods_list:res}\r\n                try{\r\n                    let query = await good_collect.where({table_number,transac_status:'unsettled'}).field({_id:true,sett_amount:true}).get()\r\n                    if(query.data.length == 0){\r\n                    \t// 1.客户初次来店里下单；2.之前吃过了已经都结账了\r\n                    \tawait good_collect.add({data:order})\r\n                    }else{\r\n                    \t// 002号桌没有结账，就是加菜\r\n                    \tlet total_amount = Number(query.data[0].sett_amount) + sett_amount\r\n                    \tawait good_collect.doc(query.data[0]._id).update({\r\n                    \t\tdata:{\r\n                    \t\t\tsett_amount:total_amount,\r\n                    \t\t\torder_receiving:'mis_orders',\r\n                    \t\t\tmenu:_.unshift(add_goods)\r\n                    \t\t}\r\n                    \t})\r\n                    }\r\n                    // 批量自增售出数量\r\n                    res.forEach(async item=>{\r\n                    \tawait dishes_data.doc(item._id).update({data:{monthlysale:_.inc(item.quantity)}})\r\n                    })\r\n                    // 计算当天的销售额\r\n                    const time_data = this.$Time().utcOffset(8).format('YYYY-MM-DD')\r\n                    await new analysis().sameday(time_data,sett_amount)\r\n                    this.push_message()// 推送订单提醒\r\n                    // 跳转订单详情界面\r\n                    wx.redirectTo({\r\n                      url: '/pages/order-details/details'\r\n                    })\r\n                    // 打印小票\r\n                    await yunPrint(table_number,number_of_diners,res,sett_amount,order.order_time)\r\n                }catch(e){\r\n                    wx.showToast({title: '发生错误',icon: 'error'})\r\n                }\r\n            },\r\n            \r\n            // 推送订单提醒\r\n            push_message(){\r\n            \tvar pubsub = this.goeasy.pubsub;\r\n            \tpubsub.publish({\r\n            \t    channel: \"my_channel\",//替换为您自己的channel\r\n            \t    message: \"小程序端来的\",//替换为您想要发送的消息内容\r\n            \t    onSuccess:()=>{\r\n            \t        console.log(\"消息发布成功。\");\r\n            \t    },\r\n            \t    onFailed:(error)=> {\r\n            \t        console.log(\"发送消息失败\");\r\n            \t    }\r\n            \t});\r\n            },\r\n            \r\n            // 我的订单\r\n            my_order(){\r\n            \twx.navigateTo({\r\n            \t\turl:'/pages/my-order/my-order'\r\n            \t})\r\n            }\r\n        },\r\n        onLoad() {\r\n            // 获取用餐人数\r\n            this.number_people = wx.getStorageSync('number_of_diners')\r\n            this.dishEs()\r\n        },\r\n        \r\n        onShow(){\r\n            wx.hideHomeButton()\r\n        },\r\n        \r\n        computed:{\r\n        \t// 计算购物车的菜品总数\r\n        \ttotal_quantity(){\r\n        \t\tlet quantity = 0\r\n        \t\tthis.shopping_card.forEach(item=>{\r\n        \t\t\tquantity += item.quantity\r\n        \t\t})\r\n        \t\treturn quantity\r\n        \t}\r\n        }\r\n    }\r\n</script>\r\n\r\n<style scoped>\r\n    .top-view {\r\n        background: linear-gradient(to bottom, #f7d45f, #f7d562, #f8d561, #f9db76, #f9de80);\r\n        height: 120rpx;\r\n        display: flex;\r\n        justify-content: space-between;\r\n        align-items: center;\r\n        padding: 0 20rpx;\r\n        position: fixed;\r\n        top: 0;\r\n        right: 0;\r\n        left: 0;\r\n    }\r\n\r\n    .top-view image {\r\n        display: block;\r\n        width: 35rpx;\r\n        height: 35rpx;\r\n    }\r\n\r\n    .top-view-flex {\r\n        display: flex;\r\n        align-items: center;\r\n    }\r\n\r\n    .top-search {\r\n        padding-right: 50rpx;\r\n    }\r\n\r\n    /* 点餐界面 */\r\n    .order-view {\r\n        margin-top: 120rpx;\r\n    }\r\n\r\n    .commodity {\r\n        display: flex;\r\n        position: fixed;\r\n        top: 120rpx;\r\n        left: 0;\r\n        right: 0;\r\n    }\r\n\r\n    .order-left {\r\n        background-color: #fafafa;\r\n        width: 160rpx;\r\n        overflow-y: auto;\r\n    }\r\n\r\n    .itemize-text {\r\n        font-size: 27rpx;\r\n        padding: 30rpx 10rpx;\r\n        display: flex;\r\n        align-items: center;\r\n        color: #797979;\r\n    }\r\n\r\n    .itemize-text text:nth-child(1) {\r\n        flex: 1;\r\n    }\r\n\r\n    .itemize-text text:nth-child(2) {\r\n        background-color: #eb5941;\r\n        border-radius: 50%;\r\n        font-size: 20rpx;\r\n        color: #FFFFFF;\r\n        width: 30rpx;\r\n        height: 30rpx;\r\n        display: flex;\r\n        justify-content: center;\r\n        align-items: center;\r\n        margin-left: 2rpx;\r\n    }\r\n\r\n    .scroll-Hei {\r\n        height: 100vh;\r\n    }\r\n\r\n    .order-right {\r\n        background-color: #FFFFFF;\r\n        flex: 1;\r\n        overflow-y: auto;\r\n\r\n    }\r\n\r\n    .classif {\r\n        font-size: 27rpx;\r\n        padding: 30rpx 20rpx;\r\n        color: #797979;\r\n    }\r\n\r\n    /* 分类商品 */\r\n    .classif-goods {\r\n        display: flex;\r\n        justify-content: space-between;\r\n        padding: 0 20rpx;\r\n        height: 150rpx;\r\n        font-size: 30rpx;\r\n        margin-bottom: 45rpx;\r\n    }\r\n\r\n    .goods-image image {\r\n        display: block;\r\n        width: 150rpx;\r\n        height: 150rpx;\r\n        border-radius: 10rpx;\r\n    }\r\n\r\n    .goods-Price {\r\n        flex: 1;\r\n        position: relative;\r\n        padding: 0 20rpx;\r\n    }\r\n\r\n    .goods-Price text {\r\n        display: block;\r\n    }\r\n\r\n    .goods-name {\r\n        display: flex;\r\n        flex-direction: column;\r\n        position: relative;\r\n        top: 0;\r\n    }\r\n\r\n    .goods-name text:nth-child(1) {\r\n        padding-bottom: 9rpx;\r\n    }\r\n\r\n    .unit-price {\r\n        position: absolute;\r\n        bottom: 0;\r\n        display: flex;\r\n        align-items: baseline;\r\n    }\r\n\r\n    .Bold {\r\n        font-weight: bold;\r\n    }\r\n\r\n    .Symbol {\r\n        font-size: 20rpx;\r\n    }\r\n\r\n    .Thinning {\r\n        font-size: 25rpx;\r\n        color: #cccccc;\r\n    }\r\n\r\n    .quantity image {\r\n        width: 50rpx;\r\n        height: 50rpx;\r\n    }\r\n\r\n    .quantity view {\r\n        width: 50rpx;\r\n        height: 50rpx;\r\n        text-align: center;\r\n        line-height: 50rpx;\r\n    }\r\n\r\n    .quantity {\r\n        display: flex;\r\n        align-items: center;\r\n        align-self: flex-end;\r\n        width: 200rpx;\r\n        justify-content: space-between;\r\n    }\r\n\r\n    /* 规格 */\r\n    .specs-view {\r\n        height: 50rpx;\r\n        width: 100rpx !important;\r\n        border-radius: 50rpx;\r\n        font-size: 25rpx;\r\n        justify-content: center !important;\r\n        position: relative;\r\n        background: linear-gradient(to right, #f8da81, #f8d771, #f7d362, #f6cb4a);\r\n    }\r\n\r\n    .specs-view text:nth-child(2) {\r\n        position: absolute;\r\n        right: -10rpx;\r\n        top: -17rpx;\r\n        background-color: #eb5941;\r\n        border-radius: 50%;\r\n        font-size: 20rpx;\r\n        color: #FFFFFF;\r\n        width: 30rpx;\r\n        height: 30rpx;\r\n        text-align: center;\r\n        line-height: 30rpx;\r\n    }\r\n\r\n    .order-bottom {\r\n        background-color: #fefefe;\r\n        height: 120rpx;\r\n        position: fixed;\r\n        bottom: 0;\r\n        left: 0;\r\n        right: 0;\r\n        box-shadow: 0rpx -1.9rpx 1rpx 1rpx #f9f9f9;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: space-between;\r\n        padding: 0 20rpx;\r\n        z-index: 9;\r\n    }\r\n\r\n    .Shopping image {\r\n        width: 75rpx;\r\n        height: 75rpx;\r\n        display: block;\r\n    }\r\n\r\n    .Shopping-left {\r\n        width: 75rpx;\r\n        height: 75rpx;\r\n    }\r\n\r\n    .Shopping {\r\n        display: flex;\r\n        align-items: center;\r\n    }\r\n\r\n    .Shopping-number {\r\n        align-self: flex-start;\r\n        background: #eb5941;\r\n        color: #ffff;\r\n        width: 40rpx;\r\n        border-radius: 50rpx;\r\n        text-align: center;\r\n        font-size: 20rpx;\r\n    }\r\n\r\n    .Shopping-title {\r\n\r\n        flex: 1;\r\n        padding: 0 25rpx;\r\n        color: #999999;\r\n    }\r\n\r\n    .place-order button {\r\n        border: none;\r\n        background: linear-gradient(to right, #f8da81, #f8d771, #f7d362, #f6cb4a);\r\n        width: 200rpx;\r\n        height: 75rpx;\r\n        line-height: 75rpx;\r\n        border-radius: 50rpx;\r\n        font-weight: bold;\r\n        z-index: 9;\r\n    }\r\n\r\n    /* 点击分类列表加上背景色 */\r\n    .active {\r\n        background-color: #FFFFFF;\r\n        color: #000000 !important;\r\n        font-weight: bold;\r\n    }\r\n</style>","import mod from \"-!../../../../HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./page.vue?vue&type=style&index=0&id=2f68e6da&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./page.vue?vue&type=style&index=0&id=2f68e6da&scoped=true&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1646007635517\n      var cssReload = require(\"D:/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}